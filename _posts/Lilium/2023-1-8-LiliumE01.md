---
title: "[Lilium] E01. 지형과 애니메이션 제작"
date: 2023-1-8 09:00:00 +0900
categories: [Development, Lilium]
tags: [Lilium]
---

## 결과
<iframe width="800" height="450" src="https://www.youtube.com/embed/IbMfw77vzhQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

---

## 내용
<iframe width="800" height="450" src="https://www.youtube.com/embed/JG3-7BCWqOE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

원래 메타휴먼을 이용해 플레이어 캐릭터를 제작했는데 결과물을 5에서 4로 가져오려하니 불러오기가 안됬다. 그래서 우선 다른 캐릭터를 이용해 지형과 애니메이션을 제작했다.

![Image](https://user-images.githubusercontent.com/52897037/210953351-dd4c8850-72a0-4392-b88e-a2327b6c7fba.PNG)

지형을 만드는 것 자체는 그리 어렵지 않았다.<br/>
랜드스케이프에 대한 사용법을 익히고 멋있는 스태틱 메쉬들을 가져와서 잘 배치해주니<br/>
그럴듯한 보스전 지형이 완성되었다. 날 당황스럽게 한건 SphereReflectionCapture 였다.<br/>
위에서 보이듯 스플렉션캡쳐가 지정된 영역 내부가 푸르스름한 빛을 내는데<br/>
이 영역내에서 푸르스름한 빛이 덧씌워져야할 이유도 없었고 이거 자체가 맘에 안들었다.<br/>
그래서 여러 삽질을 하다가 도저히 안되서 강사님께 조언을 구했고<br/>
푸르스름하다는건 결국 주변에 파란색 빛을 내는 무언가가 있다는 것이니 그 부분을 공략해보면 되지 않을까..<br/>
해서 맵에 배치된 색 중 파란색을 비추는 건 하늘뿐이였으니 하늘을 가릴 천장을 만들어보기로 했다.

![Image](https://user-images.githubusercontent.com/52897037/211180105-734742ea-ebb9-42d9-a69a-75c9725a362f.PNG)

큰 큐브를 만들어서 천장을 만들어 봤는데 전혀 영향을 받지 않았다.<br/>
그래서 아 하늘 색이랑은 관계가 없는건가? 싶어서 두번째로 메탈릭이 1이고 러프니스가 0인 물체를 만들어서<br/>
리플렉션캡쳐가 리턴하는 값이 무엇인지를 확인해보기로 했다.<br/>
사실 이걸 먼저 했으면 하늘색이 문제라는 것을 깨달았겠지만<br/>
이걸 먼저 하지 않은 이유는 일단 땅이 메탈릭이 0이고 러프니스가 0.5이였기 때문에<br/>
땅이 어떤 빛을 반사할 것이라고는 생각하지 않았기 때문이다.

![Image](https://user-images.githubusercontent.com/52897037/211180331-2fc3469a-0db4-46a1-957f-22197fbb82f8.PNG)

머터리얼을 하나 만들어서 배치해보니 결국 반사값중 높은 비중으로 하늘의 파란색이<br/>
반사되기 때문이라는 걸 알았고 인터넷에 리플렉션캡쳐 끄는법을 검색했더니<br/>
간단하게 리플렉션캡쳐에서 Brightness 값을 0으로 하면 된다고 하더라..<br/>
Brightness 값을 조정해줬지만 경계면은 여전히 티가 났기에 경계선상을 따라 스태틱 메쉬를 배치했다.<br/>
그렇게 해서 뭘 이런걸 고민했나 싶을정도로 쉽게 해결이 되었다.<br/>
그냥 리플렉션캡쳐를 지우면 되지 않나? 싶기도 했지만 이게 반사와 굴절효과를 싼값에 쓰게 해주는 것이니까<br/>
화려함이 돋보여야하는 전투씬에서 포인트라이트가 들어간 파티클이 튄다던지 할때<br/>
그래픽적으로 더 화려해보이지 않을까 싶어서 지우지 않았다.

다음은 애니메이션이였는데 리타겟팅에 대해 이해력을 매우 높이는 좋은 경험이였다.

![Image](https://user-images.githubusercontent.com/52897037/211180762-591ca011-edcb-41c8-b663-5e62ad248d46.PNG)
![Image](https://user-images.githubusercontent.com/52897037/211180861-93c1ad39-1edf-4b99-bb5a-11535ed90408.PNG)

처음엔 단순하게 리타겟팅하면 에브리띵 이즈 오케이일 것이란 생각으로 리타겟팅을 했다가<br/>
엄청난 떡대를 득템한 플레이어 캐릭터가 탄생했는데 본이 아예 비틀리는것으로 보였다.<br/>
포즈를 아무리 맞춰줘도 포즈 매칭은 본의 뒤틀림에 대한 근본적인 해결은 아니였다.

그래서 첫번째 해결법으로 Additive Layer Tracks를 이용해서<br/>
애니메이션마다 뒤틀려있는 본들의 위치값을 정상적인 범주로 돌리려는 시도를 했다.<br/>
이 기능의 장점은 이미 만들어진 애니메이션에서 추가적인 조정을 해줄수 있다는 것이였으나<br/>
아쉽게도 해당 기술을 사용할 당시에는 본의 회전, 스케일은 조정할 수 있었지만<br/>
본의 이동에 대해선 조정을 할 수가 없었다.

포럼도 보고 스택오버플로우, 레딧 등 인터넷을 한참 돌아다녀봤지만 해답은 엔진 도움말에 있었다.<br/>
같은 스켈레톤을 사용하는 크기가 다른 메쉬에 대해 알맞은 애니메이션 스케일을 조정해주고자 할 때<br/>
transalation retargeting의 알맞은 타입의 bone mode를 골라주면 되는데<br/>
서로 다른 스켈레톤을 릭을 이용해 동기화하고 위의 내용을 이용해서 애니메이션을 무사히 넘겨주었다.

---

## 문제

한 캐릭터에 통합된 전체 애니메이션을 가져오는게 아니라 여기서 맘에드는거 저기서 맘에드는거<br/>
짜름짜름 가져오다보니 캐릭터가 서있는 지면과 발의 높낮이가 애니메이션별로 달라 보기싫다.<br/>
여기에 2일정도를 투자해서 첫날은 본이나 다른 경로에서 해결방법이 있는지 찾아보고<br/>
해결법을 찾지 못했다면 둘쨋날에는 additive layer tracks를 이용해 일일히 애니메이션을 맞춰줘야겠다.